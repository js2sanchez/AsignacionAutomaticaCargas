-- ================================================
-- Template generated from Template Explorer using:
-- Create Procedure (New Menu).SQL
--
-- Use the Specify Values for Template Parameters 
-- command (Ctrl-Shift-M) to fill in the parameter 
-- values below.
--
-- This block of comments will not be included in
-- the definition of the procedure.
-- ================================================
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Rebeca Moreno>
-- Create date: <21/05/2015>
-- Description:	<procedure para consultar estadisticas>
-- =============================================
ALTER PROCEDURE pr_Estadisticas_Consultar_Cursos
	-- Add the parameters for the stored procedure here
	@iidPeriodo int,
	@iCodError int OUTPUT
AS

	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
    if @iidPeriodo = 0
    begin
		select nombreCurso, codigoCurso,TipoPrioridad as preferencia,COUNT(nombreCurso) as cantidad 
		from [DB_AsignacionCargas].dbo.PreferenciaCurso a
		INNER JOIN [DB_AsignacionCargas].dbo.Curso b ON
		a.fk_idCurso = b.idCurso		
		INNER JOIN [DB_AsignacionCargas].dbo.TipoPrioridad c ON 
		c.idTipoPrioridad = a.fk_idTipoPrioridad	
		where b.eliminado = 0 and
		c.eliminado = 0
		group by nombreCurso,TipoPrioridad,codigoCurso
	end
	else
	begin 
		select nombreCurso, codigoCurso,TipoPrioridad as preferencia,COUNT(nombreCurso) as cantidad 
		from [DB_AsignacionCargas].dbo.PreferenciaCurso a
		INNER JOIN [DB_AsignacionCargas].dbo.Curso b ON
		a.fk_idCurso = b.idCurso		
		INNER JOIN [DB_AsignacionCargas].dbo.TipoPrioridad c ON 
		c.idTipoPrioridad = a.fk_idTipoPrioridad	
		where b.eliminado = 0 and
		c.eliminado = 0 and  a.fk_idPeriodo = @iidPeriodo
		group by nombreCurso,TipoPrioridad,codigoCurso 
	end
SELECT @iCodError=@@ERROR

